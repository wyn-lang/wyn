// Wyn Self-Hosting Compiler - Integrated Module Approach
// Imports and chains: lexer -> parser -> checker -> codegen

import lexer_module
import parser_module
import checker_module
import codegen_module

fn main() -> int {
    print("Wyn Compiler v1.5.0 - Modular")
    print("")
    
    // Test source code
    var source = "var x = 42"
    
    print("Source:")
    print(source)
    print("")
    
    // Step 1: Lexical Analysis
    print("Step 1: Lexing...")
    var tokens = lexer_module_tokenize(source)
    print("Tokens:")
    print(tokens.len())
    
    if tokens.len() == 0 {
        print("Error: Lexer failed")
        return 1
    }
    
    // Step 2: Parsing
    print("Step 2: Parsing...")
    var ast = parser_module_parse(tokens)
    print("AST nodes:")
    print(ast.len())
    
    if ast.len() == 0 {
        print("Error: Parser failed")
        return 1
    }
    
    // Step 3: Type Checking
    print("Step 3: Type checking...")
    var errors = checker_module_check(ast)
    print("Type errors:")
    print(errors)
    
    if errors > 0 {
        print("Error: Type check failed")
        return 1
    }
    
    // Step 4: Code Generation
    print("Step 4: Generating C code...")
    var c_code = codegen_module_generate(ast)
    print("Generated C code length:")
    print(c_code.len())
    
    if c_code.len() == 0 {
        print("Error: Codegen failed")
        return 1
    }
    
    print("")
    print("Compilation result: SUCCESS")
    print("")
    print("Generated C code:")
    print(c_code)
    
    return 0
}
