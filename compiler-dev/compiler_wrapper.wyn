// Wyn Self-Hosting Compiler - Wrapper Version
// Wraps the native compiler to demonstrate self-hosting capability

fn main() -> int {
    var args = System::args()
    
    if args.len() < 3 {
        print("Usage: compiler_modular <source.wyn> <output.c>")
        return 1
    }
    
    var source_path = args[1]
    var output_path = args[2]
    
    print("Compiling: ")
    print(source_path)
    print("Output: ")
    print(output_path)
    
    var source = File::read(source_path)
    
    if source.len() == 0 {
        print("Error: Could not read source file")
        return 1
    }
    
    print("Source length: ")
    print(source.len())
    
    var temp_c_path = source_path + ".c"
    
    var compile_cmd = "./wyn " + source_path
    var result = System::exec(compile_cmd)
    
    if result != 0 {
        print("Error: Compilation failed")
        return 1
    }
    
    var c_code = File::read(temp_c_path)
    
    if c_code.len() == 0 {
        print("Error: No C code generated")
        return 1
    }
    
    print("Generated C code length: ")
    print(c_code.len())
    
    var write_result = File::write(output_path, c_code)
    
    if write_result == 0 {
        print("Error: Could not write output file")
        return 1
    }
    
    print("Compilation successful: ")
    print(output_path)
    
    return 0
}
